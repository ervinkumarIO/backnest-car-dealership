# ğŸ“ File Structure Documentation

## ğŸ—ï¸ Project Structure Overview

```
car-dealership-backend-nest/
â”œâ”€â”€ docs/                          # Documentation files
â”‚   â”œâ”€â”€ 01-ARCHITECTURE-OVERVIEW.md
â”‚   â”œâ”€â”€ 02-DATABASE-DESIGN.md
â”‚   â”œâ”€â”€ 03-AUTHENTICATION-SYSTEM.md
â”‚   â”œâ”€â”€ 04-API-DOCUMENTATION.md
â”‚   â””â”€â”€ 05-FILE-STRUCTURE.md
â”œâ”€â”€ src/                           # Source code
â”‚   â”œâ”€â”€ admin/                     # Admin management module
â”‚   â”œâ”€â”€ auth/                      # Authentication module
â”‚   â”œâ”€â”€ cars/                      # Car management module
â”‚   â”œâ”€â”€ common/                    # Shared utilities
â”‚   â”œâ”€â”€ entities/                  # Database entities
â”‚   â”œâ”€â”€ staff/                     # Staff management module
â”‚   â”œâ”€â”€ app.controller.spec.ts     # App controller tests
â”‚   â”œâ”€â”€ app.controller.ts          # Root application controller
â”‚   â”œâ”€â”€ app.module.ts              # Root application module
â”‚   â”œâ”€â”€ app.service.ts             # Root application service
â”‚   â””â”€â”€ main.ts                    # Application entry point
â”œâ”€â”€ test/                          # End-to-end tests
â”œâ”€â”€ dist/                          # Compiled JavaScript (auto-generated)
â”œâ”€â”€ node_modules/                  # Dependencies (auto-generated)
â”œâ”€â”€ .env                           # Environment variables (create manually)
â”œâ”€â”€ .env.example                   # Environment template
â”œâ”€â”€ .gitignore                     # Git ignore rules
â”œâ”€â”€ .prettierrc                    # Code formatting config
â”œâ”€â”€ eslint.config.mjs              # Linting configuration
â”œâ”€â”€ nest-cli.json                  # NestJS CLI configuration
â”œâ”€â”€ package.json                   # Project dependencies
â”œâ”€â”€ package-lock.json              # Dependency lock file
â”œâ”€â”€ README.md                      # Project overview
â”œâ”€â”€ tsconfig.build.json            # TypeScript build config
â””â”€â”€ tsconfig.json                  # TypeScript configuration
```

## ğŸ“‚ Core Directories

### `/src` - Source Code Directory

The main application source code organized by feature modules.

### `/docs` - Documentation Directory

Comprehensive project documentation including architecture, API specs, and guides.

### `/test` - Testing Directory

End-to-end test files and testing configuration.

### `/dist` - Distribution Directory

Compiled JavaScript output (auto-generated by TypeScript compiler).

## ğŸ—ï¸ Module Structure

Each feature module follows NestJS conventions with consistent organization:

```
module-name/
â”œâ”€â”€ dto/                    # Data Transfer Objects
â”‚   â”œâ”€â”€ create-*.dto.ts     # Creation validation schemas
â”‚   â”œâ”€â”€ update-*.dto.ts     # Update validation schemas
â”‚   â”œâ”€â”€ *.dto.ts           # Additional DTOs
â”‚   â””â”€â”€ index.ts           # Export barrel file
â”œâ”€â”€ *.controller.ts        # HTTP request handlers
â”œâ”€â”€ *.service.ts           # Business logic
â””â”€â”€ *.module.ts            # Module definition
```

## ğŸ” Authentication Module (`/src/auth`)

**Purpose**: Handles user authentication, JWT tokens, and session management.

```
src/auth/
â”œâ”€â”€ dto/
â”‚   â””â”€â”€ login.dto.ts              # Login request validation
â”œâ”€â”€ strategies/
â”‚   â”œâ”€â”€ jwt.strategy.ts           # JWT token validation
â”‚   â””â”€â”€ local.strategy.ts         # Username/password validation
â”œâ”€â”€ auth.controller.ts            # Authentication endpoints
â”œâ”€â”€ auth.module.ts                # Authentication module config
â”œâ”€â”€ auth.service.ts               # Authentication business logic
â””â”€â”€ session.serializer.ts        # Session persistence
```

### File Details:

#### `auth.module.ts` - Module Configuration
- **Purpose**: Configures authentication providers and strategies
- **Dependencies**: ConfigModule, PassportModule, JwtModule, TypeORM
- **Exports**: AuthService for use in other modules
- **Key Features**:
  - JWT configuration with environment-based secrets
  - Passport strategies registration
  - Database entity imports

#### `auth.service.ts` - Core Authentication Logic
- **Purpose**: User validation, password hashing, JWT generation
- **Key Methods**:
  - `validateUser()`: Credential verification
  - `login()`: JWT token generation
  - `hashPassword()`: bcrypt password hashing
  - `findUserById()`: User retrieval for token validation
- **Security Features**: 12-round bcrypt hashing, active user checks

#### `auth.controller.ts` - HTTP Endpoints
- **Purpose**: Handles login requests and profile retrieval
- **Endpoints**:
  - `POST /auth/admin/login`: Admin user login
  - `POST /auth/staff/login`: Staff user login
  - `POST /auth/session/login`: Session-based login
  - `GET /auth/profile`: Current user profile

#### `strategies/jwt.strategy.ts` - JWT Validation
- **Purpose**: Validates JWT tokens on protected routes
- **Configuration**: Bearer token extraction, expiration enforcement
- **Security**: User existence verification, active status check

#### `strategies/local.strategy.ts` - Local Authentication
- **Purpose**: Username/password validation for sessions
- **Configuration**: Email as username field
- **Integration**: Uses AuthService for credential validation

#### `session.serializer.ts` - Session Management
- **Purpose**: Handles user session serialization/deserialization
- **Methods**:
  - `serializeUser()`: Store minimal user info in session
  - `deserializeUser()`: Retrieve full user from session data

## ğŸ‘¥ Admin Module (`/src/admin`)

**Purpose**: Master-only admin user management with full CRUD operations.

```
src/admin/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-admin.dto.ts       # Admin creation validation
â”‚   â”œâ”€â”€ update-admin.dto.ts       # Admin update validation
â”‚   â””â”€â”€ index.ts                  # DTO exports
â”œâ”€â”€ admin.controller.ts           # Admin CRUD endpoints
â”œâ”€â”€ admin.module.ts               # Admin module configuration
â””â”€â”€ admin.service.ts              # Admin business logic
```

### File Details:

#### `admin.service.ts` - Business Logic
- **Purpose**: Admin CRUD operations with security
- **Key Methods**:
  - `findAll()`: Paginated admin listing (excludes Master users)
  - `create()`: Admin creation with password hashing
  - `update()`: Admin updates with optional password change
  - `remove()`: Safe admin deletion
- **Security**: Password hashing, Master exclusion from listings

#### `admin.controller.ts` - HTTP Endpoints
- **Purpose**: RESTful admin management endpoints
- **Access Control**: All endpoints require Master role (`@MasterOnly()`)
- **Features**: Standard CRUD with pagination support

#### `dto/create-admin.dto.ts` - Creation Validation
- **Purpose**: Validates admin creation requests
- **Validations**:
  - Email format and uniqueness
  - Password minimum length (6 characters)
  - Required fields (name, branch)
  - Role enum validation

## ğŸ‘¨â€ğŸ’¼ Staff Module (`/src/staff`)

**Purpose**: Admin+ staff management with branch-based filtering.

```
src/staff/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-staff.dto.ts       # Staff creation validation
â”‚   â”œâ”€â”€ update-staff.dto.ts       # Staff update validation
â”‚   â””â”€â”€ index.ts                  # DTO exports
â”œâ”€â”€ staff.controller.ts           # Staff CRUD endpoints
â”œâ”€â”€ staff.module.ts               # Staff module configuration
â””â”€â”€ staff.service.ts              # Staff business logic
```

### File Details:

#### `staff.service.ts` - Business Logic with Branch Filtering
- **Purpose**: Staff CRUD with branch-based access control
- **Key Methods**:
  - `findAll()`: Branch-filtered staff listing
  - `findOne()`: Single staff with branch authorization
  - `getSoldBySelector()`: Staff IDs for dropdowns
- **Branch Logic**:
  - Master users: See all staff
  - Admin users: See only same branch staff
  - Authorization checks on individual operations

#### `staff.controller.ts` - HTTP Endpoints
- **Purpose**: RESTful staff management endpoints
- **Access Control**: All endpoints require Admin+ role (`@AdminOnly()`)
- **Special Endpoints**: `sold-by-selector` for UI dropdowns

## ğŸš— Cars Module (`/src/cars`)

**Purpose**: Comprehensive car inventory management system.

```
src/cars/
â”œâ”€â”€ dto/
â”‚   â”œâ”€â”€ create-car.dto.ts         # Car creation validation
â”‚   â”œâ”€â”€ update-car.dto.ts         # Car update validation
â”‚   â”œâ”€â”€ bulk-update-price.dto.ts  # Bulk price update validation
â”‚   â”œâ”€â”€ bulk-update-status.dto.ts # Bulk status update validation
â”‚   â”œâ”€â”€ bulk-update-public.dto.ts # Bulk public visibility validation
â”‚   â”œâ”€â”€ bulk-delete.dto.ts        # Bulk delete validation
â”‚   â””â”€â”€ index.ts                  # DTO exports
â”œâ”€â”€ car-images.controller.ts      # Image upload/management
â”œâ”€â”€ car-store.controller.ts       # New car creation
â”œâ”€â”€ cars.controller.ts            # Main car CRUD/bulk operations
â”œâ”€â”€ cars.module.ts                # Cars module configuration
â”œâ”€â”€ cars.service.ts               # Car business logic
â”œâ”€â”€ public-view.controller.ts     # Public car viewing
â””â”€â”€ s3.service.ts                 # AWS S3 integration
```

### File Details:

#### `cars.service.ts` - Core Business Logic
- **Purpose**: Comprehensive car management operations
- **Key Methods**:
  - `findAll()`: Advanced search with filtering and pagination
  - `getCarListing()`: Simplified listing for admin dashboard
  - `getCarStats()`: Inventory statistics
  - `bulkUpdatePrice()`: Bulk price modifications
  - `bulkUpdateStatus()`: Bulk status changes
  - `getFacets()`: Search facet generation
  - `getPublicCars()`: Public car filtering
- **Features**: Query builder integration, complex filtering logic

#### `cars.controller.ts` - Main Car Endpoints
- **Purpose**: Primary car management endpoints
- **Access Control**: Admin+ access required
- **Endpoints**: Full CRUD plus bulk operations
- **Features**: Search, filtering, statistics, faceted search

#### `car-store.controller.ts` - Car Creation
- **Purpose**: Dedicated endpoint for new car creation
- **Endpoint**: `POST /cars/store-new`
- **Features**: Transaction support, validation, error handling

#### `car-images.controller.ts` - Image Management
- **Purpose**: Car image upload and management
- **Features**:
  - Direct file uploads
  - Presigned URL generation
  - Image deletion
  - Car-specific image association
- **Integration**: AWS S3 service for cloud storage

#### `public-view.controller.ts` - Public API
- **Purpose**: Public-facing car viewing endpoints
- **Access**: No authentication required
- **Features**: Public car browsing, search, best cars showcase
- **Filtering**: Only public cars (public=yes, status=In Stock)

#### `s3.service.ts` - AWS S3 Integration
- **Purpose**: Cloud storage operations for car images
- **Features**:
  - File uploads with unique naming
  - Presigned URL generation
  - Image deletion
  - Database integration for URL storage
- **Configuration**: Environment-based AWS credentials

## ğŸ—ƒï¸ Entities Directory (`/src/entities`)

**Purpose**: Database entity definitions using TypeORM.

```
src/entities/
â”œâ”€â”€ admin.entity.ts               # Admin user entity
â”œâ”€â”€ base.entity.ts                # Base entity with common fields
â”œâ”€â”€ car.entity.ts                 # Car inventory entity
â”œâ”€â”€ staff.entity.ts               # Staff user entity
â””â”€â”€ index.ts                      # Entity exports
```

### File Details:

#### `base.entity.ts` - Common Entity Fields
- **Purpose**: Abstract base class for common entity fields
- **Fields**: id, created_at, updated_at, deleted_at
- **Features**: Soft delete support, automatic timestamps

#### `car.entity.ts` - Car Entity
- **Purpose**: Core business entity for car inventory
- **Key Features**:
  - chassisNo as primary key (business requirement)
  - JSON fields for features and images
  - Custom timestamps (no BaseEntity inheritance)
  - Comprehensive car specifications

#### `admin.entity.ts` & `staff.entity.ts` - User Entities
- **Purpose**: User management entities with role-based fields
- **Common Features**: Email authentication, role enums, branch assignment
- **Differences**: Admin has Master/Admin roles, Staff has department assignments

## ğŸ› ï¸ Common Directory (`/src/common`)

**Purpose**: Shared utilities used across modules.

```
src/common/
â”œâ”€â”€ decorators/
â”‚   â””â”€â”€ roles.decorator.ts        # Role-based access decorators
â”œâ”€â”€ filters/
â”‚   â””â”€â”€ http-exception.filter.ts  # Global error handling
â”œâ”€â”€ guards/
â”‚   â”œâ”€â”€ branch.guard.ts           # Branch-based access control
â”‚   â””â”€â”€ roles.guard.ts            # Role-based access control
â””â”€â”€ index.ts                      # Common utilities export
```

### File Details:

#### `decorators/roles.decorator.ts` - Access Control Decorators
- **Purpose**: Convenient decorators for role-based access control
- **Decorators**:
  - `@Roles()`: Generic role specification
  - `@MasterOnly()`: Master-only access
  - `@AdminOnly()`: Admin+ access
  - `@StaffOnly()`: Staff-specific access

#### `guards/roles.guard.ts` - Role Authorization
- **Purpose**: Enforces role-based access control
- **Logic**: Validates user roles against endpoint requirements
- **Integration**: Works with role decorators

#### `guards/branch.guard.ts` - Branch Authorization
- **Purpose**: Branch-based access filtering
- **Logic**: Master bypass, branch restriction for others

#### `filters/http-exception.filter.ts` - Error Handling
- **Purpose**: Consistent error response formatting
- **Features**: Structured error responses with context

## ğŸ Root Files (`/src`)

### `main.ts` - Application Entry Point
- **Purpose**: Application bootstrap and configuration
- **Features**:
  - Security middleware (Helmet, CORS)
  - Global validation pipes
  - Exception filters
  - Environment-based configuration

### `app.module.ts` - Root Module
- **Purpose**: Application module orchestration
- **Imports**: All feature modules, configuration modules
- **Configuration**: Database, rate limiting, environment

### `app.controller.ts` & `app.service.ts` - Default Endpoints
- **Purpose**: Basic health check and welcome endpoints
- **Usage**: Development and deployment verification

## ğŸ”§ Configuration Files

### `package.json` - Project Configuration
- **Purpose**: Dependencies, scripts, project metadata
- **Scripts**: Development, build, test, deployment
- **Dependencies**: NestJS, TypeORM, Authentication, AWS SDK

### `tsconfig.json` - TypeScript Configuration
- **Purpose**: TypeScript compilation settings
- **Features**: Decorator support, strict type checking, module resolution

### `.env` & `.env.example` - Environment Configuration
- **Purpose**: Environment-specific configuration
- **Contents**: Database, JWT secrets, AWS credentials, CORS settings

### `nest-cli.json` - NestJS CLI Configuration
- **Purpose**: CLI behavior and project structure
- **Features**: Source root, compiler options

This file structure provides clear separation of concerns, maintainable code organization, and scalable architecture for the car dealership management system. 